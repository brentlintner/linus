#!/bin/bash

set -e

VERSION=$1

if [ -z "$VERSION" ]; then
  echo "Usage: bin/release <version>"
  exit 1
fi

# Basic semver check.  Might want to beef this up.
if ! echo "$VERSION" | grep -qE '^[0-9]+\.[0-9]+\.[0-9]+$'; then
  echo "Invalid version format. Use semver (e.g., 1.2.3)."
  exit 1
fi

# Update the version in the Python file.  Assumes a specific format.
sed -i.bak "s/__version__ = \".*\"/__version__ = \"$VERSION\"/" src/__version__.py
rm src/__version__.py.bak # Get rid of the backup file.  We're using git, right?

# Commit and tag
git commit -m "v$VERSION" src/__version__.py
git tag "v$VERSION"

echo "Released version v$VERSION"
